(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"93f35fe1-3703-4371-a5c8-df2f38c921df","Content-Type":"application/json"},method:{patch:"PATCH",post:"POST",put:"PUT",delete:"DELETE"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))},n=document.querySelector("#card-template"),r=function(e,t,r,o,c){var a=function(e){return e.content.cloneNode(!0)}(n);a.querySelector(".card").setAttribute("id",e._id);var i=a.querySelector(".card__image");i.src=e.link,i.alt=e.name,i.addEventListener("click",c),a.querySelector(".card__title").textContent=e.name;var u=a.querySelector(".card__delete-button");u.setAttribute("id",e.owner._id),u.addEventListener("click",r),t!==e.owner._id&&(console.log("Сработало"),u.style.display="none");var s=a.querySelector(".card__like-button");return s.addEventListener("click",o),e.likes.some((function(e){return e._id===t}))&&s.classList.add("card__like-button_is-active"),a.querySelector(".card__count-of-likes").textContent=e.likes.length,a},o=function(n){var r,o=n.target.closest(".card");(r=o.getAttribute("id"),fetch("".concat(e.baseUrl,"/cards/").concat(r),{headers:e.headers,method:e.method.delete}).then(t)).then((function(e){return o.remove()})).catch((function(e){return console.error(e)}))},c=function(n){var r=n.target,o=r.nextElementSibling,c=r.closest(".card").getAttribute("id"),a=r.classList.contains("card__like-button_is-active");(function(n,r){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{headers:e.headers,method:r?e.method.delete:e.method.put}).then(t)})(c,a).then((function(e){a?r.classList.remove("card__like-button_is-active"):r.classList.add("card__like-button_is-active"),o.classList.contains("card__count-of-likes")&&(o.textContent=e.likes.length)})).catch((function(e){return console.error(e)}))},a=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",s)},i=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s)},u=function(e){var t=!e.target.closest(".popup__content"),n=e.target.closest(".popup");t&&i(n)};function s(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&i(t)}}var l={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popap__input-error_active"};function d(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(l.inputErrorClass),n.textContent="",n.classList.remove(l.errorClass)}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l,n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?d(e,t):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(l.inputErrorClass),r.textContent=n,r.classList.add(l.errorClass)}(e,t,t.validationMessage)})(e,o),function(e,t,n){e.every((function(e){return e.validity.valid}))?(t.classList.remove(n),t.disabled=!1):f(t,n)}(n,r,t.inactiveButtonClass)}))}))}function f(e,t){e.classList.add(t),e.disabled=!0}function m(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(t){d(e,t),t.setCustomValidity("")})),f(r,t.inactiveButtonClass)}var v=document.querySelector(".places__list"),_=null,h=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_image"),S=document.querySelector(".popup_type_avatar_edit"),C=document.querySelectorAll(".popup"),q=document.querySelector(".popup__image"),g=document.querySelector(".popup__caption"),k=document.querySelector(".profile__edit-button"),L=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__edit-avatar-button"),x=document.forms["new-place"],A=document.forms["edit-profile"],U=document.forms["edit-avatar"],T=document.querySelector(".profile__title"),w=document.querySelector(".profile__description"),B=document.querySelector(".profile__image"),P=A.elements.name,D=A.elements.description,N=U.elements["avatar-link"],O=x.elements["place-name"],j=x.elements.link,J=function(e){var t=e.target,n=t.src,r=t.alt;q.src=n,q.alt=r,g.textContent=r,a(b)};Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t)]).then((function(e){var t=e[0],n=e[1];_=t._id,T.textContent=t.name,w.textContent=t.about,B.style.backgroundImage="url(".concat(t.avatar,")"),function(e,t){e.forEach((function(e){var n=r(e,t,o,c,J);v.append(n)}))}(n,_)})).catch((function(e){return console.error(e)})),A.addEventListener("submit",(function(n){n.preventDefault();var r=n.currentTarget.querySelector(".button"),o={name:P.value,about:D.value};r.textContent="Cохранение....",function(n){return fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers,method:e.method.patch,body:JSON.stringify({name:n.name,about:n.about})}).then(t)}(o).then((function(e){T.textContent=e.name,w.textContent=e.about,i(h)})).catch((function(e){return console.error(e)})).finally((function(){return r.textContent="Cохранить"}))})),x.addEventListener("submit",(function(n){n.preventDefault();var a=n.currentTarget.querySelector(".button"),u={name:O.value,link:j.value};a.textContent="Cохранение....",function(n){return fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers,method:e.method.post,body:JSON.stringify({name:n.name,link:n.link})}).then(t)}(u).then((function(e){var t=r(e,_,o,c,J);v.prepend(t),x.reset(),i(y)})).catch((function(e){return console.error(e)})).finally((function(){return a.textContent="Cохранить"}))})),U.addEventListener("submit",(function(n){n.preventDefault();var r,o=n.currentTarget,c=o.querySelector(".button");c.textContent="Cохранение....",(r=N.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{headers:e.headers,method:e.method.patch,body:JSON.stringify({avatar:r})}).then(t)).then((function(e){B.style.backgroundImage="url(".concat(e.avatar,")"),o.reset(),i(S)})).catch((function(e){return console.error(e)})).finally((function(){return c.textContent="Cохранить"}))})),k.addEventListener("click",(function(){a(h),P.value=T.textContent,D.value=w.textContent,m(A,l)})),E.addEventListener("click",(function(){U.reset(),a(S),m(U,l)})),L.addEventListener("click",(function(){x.reset(),a(y),m(x,l)})),C.forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("click",(function(t){t.target.classList.contains("popup__close")&&i(e)})),e.addEventListener("click",u)})),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l;Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){return p(t,e)}))}(l)})();