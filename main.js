(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"93f35fe1-3703-4371-a5c8-df2f38c921df","Content-Type":"application/json"},method:{patch:"PATCH",post:"POST",put:"PUT",delete:"DELETE"}},e=document.querySelector("#card-template"),n=function(t,n,r,o,c){var a=function(t){return t.content.cloneNode(!0)}(e);a.querySelector(".card").setAttribute("id",t._id);var u=a.querySelector(".card__image");u.src=t.link,u.alt=t.name,u.addEventListener("click",c),a.querySelector(".card__title").textContent=t.name;var i=a.querySelector(".card__delete-button");i.setAttribute("id",t.owner._id),i.addEventListener("click",r);var s=a.querySelector(".card__like-button");return s.addEventListener("click",o),t.likes.some((function(t){return t._id===n}))&&s.classList.add("card__like-button_is-active"),a.querySelector(".card__count-of-likes").textContent=t.likes.length,a},r=function(e){var n,r=e.target.parentNode;(n=r.getAttribute("id"),fetch("".concat(t.baseUrl,"/cards/").concat(n),{headers:t.headers,method:t.method.delete}).then((function(t,e){return t.ok?t.json():e("Ошибка ".concat(t.status))}))).then((function(t){return r.remove()})).catch((function(t){return console.error(t)}))},o=function(e){var n=e.target,r=n.nextElementSibling,o=n.closest(".card").getAttribute("id"),c=n.classList.contains("card__like-button_is-active");(function(e,n){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{headers:t.headers,method:n?t.method.delete:t.method.put}).then((function(t,e){return t.ok?t.json():e("Ошибка ".concat(t.status))}))})(o,c).then((function(t){c?n.classList.remove("card__like-button_is-active"):n.classList.add("card__like-button_is-active"),r.classList.contains("card__count-of-likes")&&(r.textContent=t.likes.length)})).catch((function(t){return console.error(t)}))},c=function(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",i)},a=function(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)},u=function(t){var e=!t.target.closest(".popup__content"),n=t.target.closest(".popup");e&&a(n)};function i(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&a(e)}}var s={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popap__input-error_active"};function l(t,e){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(s.inputErrorClass),n.textContent="",n.classList.remove(s.errorClass)}function d(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s,n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){(function(t,e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?l(t,e):function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(s.inputErrorClass),r.textContent=n,r.classList.add(s.errorClass)}(t,e,e.validationMessage)})(t,o),function(t,e,n){t.every((function(t){return t.validity.valid}))?(e.classList.remove(n),e.disabled=!1):p(e,n)}(n,r,e.inactiveButtonClass)}))}))}function p(t,e){t.classList.add(e),t.disabled=!0}function f(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(e){l(t,e),e.setCustomValidity("")})),p(r,e.inactiveButtonClass)}var m=document.querySelector(".places__list"),_=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-card"),h=document.querySelector(".popup_type_image"),y=document.querySelector(".popup_type_avatar_edit"),b=document.querySelectorAll(".popup"),S=document.querySelector(".popup__image"),k=document.querySelector(".popup__caption"),C=document.querySelector(".profile__edit-button"),g=document.querySelector(".profile__add-button"),q=document.querySelector(".profile__edit-avatar-button"),L=document.forms["new-place"],E=document.forms["edit-profile"],x=document.forms["edit-avatar"],A=document.querySelector(".profile__title"),U=document.querySelector(".profile__description"),j=document.querySelector(".profile__image"),T=E.elements.name,B=E.elements.description,w=x.elements["avatar-link"],N=L.elements["place-name"],D=L.elements.link,O=function(t){var e=t.target,n=e.src,r=e.alt;S.src=n,S.alt=r,k.textContent=r};Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(t,e){return t.ok?t.json():e("Ошибка ".concat(t.status))})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(t,e){return t.ok?t.json():e("Ошибка ".concat(t.status))}))]).then((function(t){var e=t[0],c=t[1],a=e._id;A.textContent=e.name,U.textContent=e.about,j.style.backgroundImage="url(".concat(e.avatar,")"),function(t,e){t.forEach((function(t){var c=n(t,e,r,o,O);m.append(c)}))}(c,a),function(t){document.querySelectorAll(".card__delete-button").forEach((function(e){e.getAttribute("id")!==t&&(e.style.display="none")}))}(a)})).catch((function(t){return console.error(t)})),E.addEventListener("submit",(function(e){e.preventDefault();var n=e.currentTarget.querySelector(".button"),r={name:T.value,about:B.value};n.textContent="Cохранение....",function(e){return fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers,method:t.method.patch,body:JSON.stringify({name:e.name,about:e.about})}).then((function(t,e){return t.ok?t.json():e("Ошибка ".concat(t.status))}))}(r).then((function(t){A.textContent=t.name,U.textContent=t.about,a(_)})).catch((function(t){return console.error(t)})).finally((function(){return n.textContent="Cохранить"}))})),L.addEventListener("submit",(function(e){e.preventDefault();var c=e.currentTarget.querySelector(".button"),u={name:N.value,link:D.value};c.textContent="Cохранение....",function(e){return fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers,method:t.method.post,body:JSON.stringify({name:e.name,link:e.link})}).then((function(t,e){return t.ok?t.json():e("Ошибка ".concat(t.status))}))}(u).then((function(t){var e=n(t,r,o,O);m.prepend(e),L.reset(),a(v)})).catch((function(t){return console.error(t)})).finally((function(){return c.textContent="Cохранить"}))})),x.addEventListener("submit",(function(e){e.preventDefault();var n,r=e.currentTarget,o=r.querySelector(".button");o.textContent="Cохранение....",(n=w.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{headers:t.headers,method:t.method.patch,body:JSON.stringify({avatar:n})}).then((function(t,e){return t.ok?t.json():e("Ошибка ".concat(t.status))}))).then((function(t){j.style.backgroundImage="url(".concat(t.avatar,")"),r.reset(),a(y)})).catch((function(t){return console.error(t)})).finally((function(){return o.textContent="Cохранить"}))})),C.addEventListener("click",(function(){c(_),T.value=A.textContent,B.value=U.textContent,f(E,s)})),q.addEventListener("click",(function(){x.reset(),c(y),f(x,s)})),g.addEventListener("click",(function(){L.reset(),c(v),f(L,s)})),m.addEventListener("click",(function(t){t.target.classList.contains("card__image")&&c(h)})),b.forEach((function(t){t.classList.add("popup_is-animated"),t.addEventListener("click",(function(e){e.target.classList.contains("popup__close")&&a(t)})),t.addEventListener("click",u)})),function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){return d(e,t)}))}(s)})();