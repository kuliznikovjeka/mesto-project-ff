(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"93f35fe1-3703-4371-a5c8-df2f38c921df","Content-Type":"application/json"},method:{patch:"PATCH",post:"POST",put:"PUT",delete:"DELETE"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))},n=document.querySelector("#card-template"),r=function(e,t,r,o,c){var a=function(e){return e.content.cloneNode(!0)}(n);a.querySelector(".card").setAttribute("id",e._id);var i=a.querySelector(".card__image");i.src=e.link,i.alt=e.name,i.addEventListener("click",c),a.querySelector(".card__title").textContent=e.name;var u=a.querySelector(".card__delete-button");u.setAttribute("id",e.owner._id),u.addEventListener("click",r);var s=a.querySelector(".card__like-button");return s.addEventListener("click",o),e.likes.some((function(e){return e._id===t}))&&s.classList.add("card__like-button_is-active"),a.querySelector(".card__count-of-likes").textContent=e.likes.length,a},o=function(n){var r,o=n.target.parentNode;(r=o.getAttribute("id"),fetch("".concat(e.baseUrl,"/cards/").concat(r),{headers:e.headers,method:e.method.delete}).then(t)).then((function(e){return o.remove()})).catch((function(e){return console.error(e)}))},c=function(n){var r=n.target,o=r.nextElementSibling,c=r.closest(".card").getAttribute("id"),a=r.classList.contains("card__like-button_is-active");(function(n,r){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{headers:e.headers,method:r?e.method.delete:e.method.put}).then(t)})(c,a).then((function(e){a?r.classList.remove("card__like-button_is-active"):r.classList.add("card__like-button_is-active"),o.classList.contains("card__count-of-likes")&&(o.textContent=e.likes.length)})).catch((function(e){return console.error(e)}))},a=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",s)},i=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s)},u=function(e){var t=!e.target.closest(".popup__content"),n=e.target.closest(".popup");t&&i(n)};function s(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&i(t)}}var l={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popap__input-error_active"};function d(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(l.inputErrorClass),n.textContent="",n.classList.remove(l.errorClass)}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l,n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?d(e,t):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(l.inputErrorClass),r.textContent=n,r.classList.add(l.errorClass)}(e,t,t.validationMessage)})(e,o),function(e,t,n){e.every((function(e){return e.validity.valid}))?(t.classList.remove(n),t.disabled=!1):f(t,n)}(n,r,t.inactiveButtonClass)}))}))}function f(e,t){e.classList.add(t),e.disabled=!0}function m(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(t){d(e,t),t.setCustomValidity("")})),f(r,t.inactiveButtonClass)}var _=document.querySelector(".places__list"),v=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),y=document.querySelector(".popup_type_image"),b=document.querySelector(".popup_type_avatar_edit"),S=document.querySelectorAll(".popup"),C=document.querySelector(".popup__image"),g=document.querySelector(".popup__caption"),q=document.querySelector(".profile__edit-button"),k=document.querySelector(".profile__add-button"),L=document.querySelector(".profile__edit-avatar-button"),E=document.forms["new-place"],x=document.forms["edit-profile"],A=document.forms["edit-avatar"],U=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),B=document.querySelector(".profile__image"),w=x.elements.name,N=x.elements.description,P=A.elements["avatar-link"],D=E.elements["place-name"],O=E.elements.link,j=function(e){var t=e.target,n=t.src,r=t.alt;C.src=n,C.alt=r,g.textContent=r};Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t)]).then((function(e){var t=e[0],n=e[1],a=t._id;U.textContent=t.name,T.textContent=t.about,B.style.backgroundImage="url(".concat(t.avatar,")"),function(e,t){e.forEach((function(e){var n=r(e,t,o,c,j);_.append(n)}))}(n,a),function(e){document.querySelectorAll(".card__delete-button").forEach((function(t){t.getAttribute("id")!==e&&(t.style.display="none")}))}(a)})).catch((function(e){return console.error(e)})),x.addEventListener("submit",(function(n){n.preventDefault();var r=n.currentTarget.querySelector(".button"),o={name:w.value,about:N.value};r.textContent="Cохранение....",function(n){return fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers,method:e.method.patch,body:JSON.stringify({name:n.name,about:n.about})}).then(t)}(o).then((function(e){U.textContent=e.name,T.textContent=e.about,i(v)})).catch((function(e){return console.error(e)})).finally((function(){return r.textContent="Cохранить"}))})),E.addEventListener("submit",(function(n){n.preventDefault();var a=n.currentTarget.querySelector(".button"),u={name:D.value,link:O.value};a.textContent="Cохранение....",function(n){return fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers,method:e.method.post,body:JSON.stringify({name:n.name,link:n.link})}).then(t)}(u).then((function(e){var t=r(e,null,o,c,j);_.prepend(t),E.reset(),i(h)})).catch((function(e){return console.error(e)})).finally((function(){return a.textContent="Cохранить"}))})),A.addEventListener("submit",(function(n){n.preventDefault();var r,o=n.currentTarget,c=o.querySelector(".button");c.textContent="Cохранение....",(r=P.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{headers:e.headers,method:e.method.patch,body:JSON.stringify({avatar:r})}).then(t)).then((function(e){B.style.backgroundImage="url(".concat(e.avatar,")"),o.reset(),i(b)})).catch((function(e){return console.error(e)})).finally((function(){return c.textContent="Cохранить"}))})),q.addEventListener("click",(function(){a(v),w.value=U.textContent,N.value=T.textContent,m(x,l)})),L.addEventListener("click",(function(){A.reset(),a(b),m(A,l)})),k.addEventListener("click",(function(){E.reset(),a(h),m(E,l)})),_.addEventListener("click",(function(e){e.target.classList.contains("card__image")&&a(y)})),S.forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("click",(function(t){t.target.classList.contains("popup__close")&&i(e)})),e.addEventListener("click",u)})),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l;Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){return p(t,e)}))}(l)})();